!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core")):"function"==typeof define&&define.amd?define("cust-form-builder",["exports","@angular/core"],t):t(e["cust-form-builder"]={},e.ng.core)}(this,function(e,t){"use strict";var a=function(){function e(){}return e.prototype.externalAction=function(e,t){var a,i="/**\n",r=[],n=0;for(var s in e.parameters)i+="* @param {"+e.parameters[s]+"} "+s+"\n",r.push(((a={})[s]=e.args[n],a)),n++;return i+="* @returns {"+e.returnType+"}\n*/\n("+t.toString()+")();",JSON.stringify({actionName:e.actionName,action:i,parameters:r,args:e.args})},e.prototype.actionFromPackage=function(e){return JSON.stringify({"package":e["package"],parameters:e.parameters})},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),i=function(){function e(){}return e.prototype.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a={bind:{values:[],operator:"concat"}};for(var i in e)a.bind.values.push(e[i]);return JSON.stringify(a)},e.prototype.add=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a={bind:{values:[],operator:"add"}};for(var i in e)a.bind.values.push(e[i]);return JSON.stringify(a)},e.prototype.substract=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a={bind:{values:[],operator:"substract"}};for(var i in e)a.bind.values.push(e[i]);return JSON.stringify(a)},e.prototype.multiply=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a={bind:{values:[],operator:"multiply"}};for(var i in e)a.bind.values.push(e[i]);return JSON.stringify(a)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),r=function(){function e(){}return e.prototype.condition=function(e){for(var t,a,i=e.toString(),r=i.substring(i.indexOf("{")+1,i.lastIndexOf("}")).split("\n"),n=[],s=null,o=null,l=0;l<r.length;l++)r[l].trim().startsWith("if")&&("true"==(s=r[l].substring(r[l].indexOf('"')+1,r[l].lastIndexOf('"')))&&(s=!0),"false"==s&&(s=!1),"true"==(o=r[l+1].substring(r[l+1].indexOf('"')+1,r[l+1].lastIndexOf('"')))&&(o=!0),"false"==o&&(o=!1),n.push(((t={})[r[l].substring(r[l].indexOf(".")+1,r[l].lastIndexOf("("))]=((a={})[r[l].substring(r[l].indexOf("(")+1,r[l].indexOf("."))]=s,a),t.value=o,t)));return JSON.stringify(n)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),n=function(){function e(){}return e.prototype.externalValidation=function(e){return JSON.stringify({target:e.targetFields,source:e.validationAction,label:e.label})},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),s=function(){function e(){}return e.prototype.regex=function(e,t){return JSON.stringify({pattern:{value:e,message:t||""}})},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var o=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],e}();e.ActionService=a,e.ComputedValueService=i,e.ConditionService=r,e.ExternalValidationService=n,e.RegexService=s,e.prerend=function l(){require("zone.js/dist/zone-node"),require("reflect-metadata");var e=require("@angular/platform-server").renderModuleFactory,v=require("htmlparser2"),t=function(){this.pages=[]};t.prototype.addPage=function(e){this.pages.push(e)},t.prototype.getPage=function(e){for(var t in this.pages)if(this.pages[t].id==e)return this.pages[t];return null};var S=function(){this.layout=new t,this.schema={},this.options={}},x=function(e,t,a,i){this.id=e,this.sections=t,this.title=a,this.state=i};x.prototype.addSection=function(e){this.sections.push(e)},x.prototype.getSection=function(e){for(var t in this.sections)if(this.sections[t].id==e)return this.sections[t];return null},x.prototype.setTitle=function(e){this.title=e};var w=function(e,t,a){this.id=e,this.display=t,this.state=a},O=function(e,t,a,i,r){this.type=e,this.constraints=t||{},this.label=a||undefined,this.placeholder=i||undefined,this.valueList=r||undefined},N=function(){this.visible=!0,this["read-only"]=!1},k=function(e,t){this.id=e,this.fields=t};k.prototype.addField=function(e){this.fields.push(e)},k.prototype.getField=function(e){for(var t in this.fields)if(this.fields[t].id==e)return this.fields[t];return null};var F=function(e,t){if(e!=undefined&&""!=e)return e;for(var a=t+"_",i="abcdefghijklmnopqrstuvwxyz0123456789",r=0;r<8;r++)a+=i.charAt(Math.floor(Math.random()*i.length));return a},J=function(e,t,a){if(function c(e){try{JSON.parse(e)}catch(t){return!1}return!0}(e)){var i=JSON.parse(e);if(i.hasOwnProperty("actionName")){var r=require("xml-js");try{var n=t.readFileSync("../pom.xml")}catch(d){console.log("valueSource() reading pom.xml:"+d)}var s=r.xml2js(n,{ignoreComment:!0,compact:!0,ignoreDoctype:!0,ignoreCdata:!0,ignoreAttributes:!0,ignoreInstruction:!0,ignoreDeclaration:!0}),o=s.project.groupId._text+"/"+s.project.artifactId._text,l=o.replace(/\./g,"/")+"/";try{t.writeFileSync(a.join("actions/src/main/resources/"+l,i.actionName+".js"),i.action)}catch(d){console.log("valueSource() writing action files:"+d)}return{type:"scriptAction",id:o+"/"+i.actionName,parameters:i.parameters}}if(i.hasOwnProperty("package"))return{type:"scriptAction",id:i["package"],parameters:i.parameters};if(i.hasOwnProperty("bind")||i.hasOwnProperty("type"))return i}if("true"==e)return!0;if("false"==e)return!1;if(!(e.startsWith("[{")||e.startsWith("{")||e.startsWith("['")))return isNaN(parseInt(e))?e:parseInt(e);try{return JSON.parse(e.replace(/\'/g,'"'))}catch(d){console.log("valueSource() ---\x3e else if (source.startsWith...: ",d)}},I=function(e,t,a,i,r,n){if(e.visibility&&(t.state.visible=J(e.visibility,r,n)),e.readonly&&(t.state["read-only"]=J(e.readonly,r,n)),e.value&&(i.schema[a]["default"]=J(e.value,r,n)),e.valueList&&(i.schema[a].valueList=J(e.valueList,r,n)),e.bind)if(e.bind.startsWith("{"))try{i.schema[a]["default"]={bind:JSON.parse(e.bind.replace(/\'/g,'"'))}}catch(l){console.log("checkAttributes() ---\x3e attribs.bind",l)}else i.schema[a]["default"]={bind:e.bind};if(e.signpost&&(i.schema[a].signpost=e.signpost),e.description&&(i.schema[a].description=e.description),e.required&&(i.schema[a].constraints.required=J(e.required,r,n)),e.regex){try{var s=JSON.parse(e.regex.replace(/\'/g,'"'))}catch(l){console.log("checkAttributes() ---\x3e attribs.regex",l)}i.schema[a].constraints.pattern=s}if(e.min&&(i.schema[a].constraints["min-value"]=J(e.min,r,n)),e.max&&(i.schema[a].constraints["max-value"]=J(e.max,r,n)),e.match&&(i.schema[a].constraints.match=e.match),e.multiple&&"false"!=e.multiple||(i.schema[a].type.isMultiple=!1),e.options){try{var o=JSON.parse(e.options.replace(/\'/g,'"'))}catch(l){console.log("checkAttributes() ---\x3e attribs.options",l)}o.source=J(JSON.stringify(o.source),r,n),i.options.externalValidations=[],i.options.externalValidations.push(o)}},n=require("fs"),s=require("path");e(require("../../../dist/custom-form-server/main").AppServerModuleNgFactory,{document:"<app-root></app-root>",url:"/"}).then(function(e){var t=function(n,s,o,e){n=new S;var l="",c=null,d=null,u=null,p=[],f=null,g=[],h=[],m=[],y=[],b=null,t=new v.Parser({onopentag:function(e,t){var a=null,i="",r=new N;switch(e){case"div":l="custom-form"==t["class"]?t.name:"defautFormName";break;case"form":c=null==c?new x(t.id||"General",[],t.title||"General",{}):new x(F(t.id,"page"),[],t.title||"New Tab",{}),t.visibility&&(c.state.visible=J(t.visibility,s,o)),n.layout.addPage(c);break;case"section":d=new k(F(t.id,"section"),[]),n.layout.getPage(c.id).addSection(d);break;case"input":switch(t.type){case"text":i=F(t.id,"textField"),a=new w(i,"textField",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"string"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o);break;case"password":i=F(t.id,"passwordField"),a=new w(i,"passwordField",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"secureString"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o);break;case"number":t.step&&t.step.startsWith("0.")?(i=F(t.id,"decimalField"),a=new w(i,"decimalField",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"decimal"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o),n.schema[i].step=parseInt(t.step)):(i=F(t.id,"integerField"),a=new w(i,"integerField",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"integer"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o),n.schema[i].step=parseInt(t.step)||1);break;case"checkbox":i=F(t.id,"checkbox"),a=new w(i,"checkbox",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"boolean"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o)}break;case"textarea":i=F(t.id,"textArea"),a=new w(i,"textArea",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"string"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o);break;case"label":i=F(t.id,"text"),a=new w(i,"text",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"string"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o);break;case"img":i=F(t.id,"image"),a=new w(i,"image",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"string"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o);break;case"table":a=null,i=F(t.id,"datagrid"),a=new w(b=i,"datagrid",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"complex",fields:[],isMultiple:!0},{},t.label,t.placeholder,p),I(t,a,i,n,s,o);break;case"tr":f=t.id,t.value&&(n.schema[b]["default"]=J(t.value,s,o));break;case"th":h.push(t.id),m.push(t.type);break;case"td":break;case"select":"true"==t.multiple?(u=i=F(t.id,"multiSelect"),a=new w(i,"multiSelect",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"string",isMultiple:!0},{},t.label,t.placeholder,p)):(u=i=F(t.id,"dropDown"),a=new w(i,"dropDown",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"string"},{},t.label,t.placeholder,p)),I(t,a,i,n,s,o);break;case"search":i=F(t.id,"valuePicker"),a=new w(i,"valuePicker",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"reference",referenceType:t.referenceType},{},t.label,t.placeholder,p||[]),I(t,a,i,n,s,o);break;case"date":i=F(t.id,"dateTime"),a=new w(i,"dateTime",r),n.layout.getPage(c.id).getSection(d.id).addField(a),n.schema[i]=new O({dataType:"dateTime"},{},t.label,t.placeholder,undefined),I(t,a,i,n,s,o)}},ontext:function(e){null!=u&&p.push(J(e,s,o)),"cols"==f&&g.push(J(e,s,o)),"data"==f&&y.push(J(e,s,o))},onclosetag:function(e){if("select"===e&&0<p.length&&(n.schema[u].valueList=p,u=null,p=[]),"table"===e){for(var t in n.schema[b].type.fields=[],n.schema[b]["default"]=[],g)n.schema[b].type.fields.push({label:g[t],id:h[t],type:{dataType:m[t]}});var a=0,i={};for(var r in y)i[h[a]]=y[r],2<++a&&(a=0,n.schema[b]["default"].push(i),i={});b=null,h=[],y=[],g=[],m=[]}}},{decodeEntities:!0});return t.write(e),t.end(),{name:l,form:n}}(a,n,s,e),a=t.form,i=t.name;try{n.writeFileSync(s.join("bin/",i+".json"),JSON.stringify(a))}catch(r){console.log("renderModuleFactory creating the custom form json file: "+r)}})["catch"](function(e){console.log(e.message)})},e.importForm=function N(e){var t=require("fs"),a=require("path");try{var i=JSON.parse(t.readFileSync(e+".json","utf8"))}catch(O){console.log("ERROR importForm() reading the custom form json file :"+O)}var r='<div class="custom-form" name="'+e.substring(e.lastIndexOf("/")+1)+'">';for(var n in i.layout.pages){for(var s in r+='<form id="'+i.layout.pages[n].id+'" title="'+i.layout.pages[n].title+'"',i.layout.pages[n].state.visible&&(r+=' visibility="'+i.layout.pages[n].state.visible+'"'),r+=">",i.layout.pages[n].sections){for(var o in r+='<section id="'+i.layout.pages[n].sections[s].id+'">',i.layout.pages[n].sections[s].fields){var l=i.layout.pages[n].sections[s].fields[o].id,c='id="'+l+'"\n                    visibility="'+JSON.stringify(i.layout.pages[n].sections[s].fields[o].state.visible).replace(/\"/g,"'")+'"\n                    readonly="'+JSON.stringify(i.layout.pages[n].sections[s].fields[o].state["read-only"]).replace(/\"/g,"'")+'"',d="",u=i.layout.pages[n].sections[s].fields[o].display;switch(u){case"text":r+="<label "+c,d="</label>";break;case"textArea":r+="<textarea "+c,d="</textarea>";break;case"textField":r+='<input type="text" '+c;break;case"passwordField":r+='<input type="password" '+c;break;case"decimalField":r+='<input type="number" step ="0."'+c;break;case"integerField":r+='<input type="number" '+c;break;case"image":r+="<img "+c;break;case"checkbox":r+='<input type="checkbox" '+c;break;case"dropDown":r+="<select "+c,d="</select>";break;case"multiSelect":r+='<select multiple="true" '+c,d="</select>";break;case"datagrid":r+="<table "+c,d="</table>"}if(i.schema[l].constraints&&(i.schema[l].constraints.required&&(r+=' required="'+JSON.stringify(i.schema[l].constraints.required).replace(/\"/g,"'")+'"'),i.schema[l].constraints["min-value"]&&(r+=' min="'+JSON.stringify(i.schema[l].constraints["min-value"]).replace(/\"/g,"'")+'"'),i.schema[l].constraints["max-value"]&&(r+=' max="'+JSON.stringify(i.schema[l].constraints["max-value"]).replace(/\"/g,"'")+'"'),i.schema[l].constraints.pattern&&(r+=' regex="'+JSON.stringify({value:i.schema[l].constraints.pattern.value,message:i.schema[l].constraints.pattern.message}).replace(/\"/g,"'")+'"'),i.schema[l].constraints.match&&(r+=' match="'+JSON.stringify(i.schema[l].constraints.match).replace(/\"/g,"'")+'"')),i.schema[l]["default"]&&("scriptAction"==i.schema[l]["default"].type||Array.isArray(i.schema[l]["default"])?r+=' value="'+JSON.stringify(i.schema[l]["default"]).replace(/\"/g,"'")+'"':i.schema[l]["default"].bind?JSON.stringify(i.schema[l]["default"].bind).startsWith("{")?r+=' bind="'+JSON.stringify(i.schema[l]["default"].bind).replace(/\"/g,"'")+'"':r+=' bind="'+JSON.stringify(i.schema[l]["default"].bind).replace(/\"/g,"")+'"':r+=' value="'+JSON.stringify(i.schema[l]["default"]).replace(/\"/g,"")+'"'),i.schema[l].valueList)if("scriptAction"==i.schema[l].valueList.type)r+=' valueList="'+JSON.stringify(i.schema[l].valueList).replace(/\"/g,"'")+'"';else{var p="";for(var f in i.schema[l].valueList)i.schema[l].valueList[f].label?p+='<option label="'+i.schema[l].valueList[f].label+'">'+i.schema[l].valueList[f].label+"</option>":p+="<option>"+JSON.stringify(i.schema[l].valueList[f]).replace(/\"/g,"")+"</option>"}if(i.schema[l].label&&(r+=' label="'+i.schema[l].label+'"'),i.schema[l].description&&(r+=' description="'+JSON.stringify(i.schema[l].description).replace(/\"/g,"")+'"'),i.schema[l].signpost&&(r+=' signpost="'+JSON.stringify(i.schema[l].signpost).replace(/\"/g,"'")+'"'),i.schema[l].step&&(r+=' step="'+JSON.stringify(i.schema[l].step).replace(/\"/g,"'")+'"'),i.schema[l].placeholder&&(r+=' step="'+JSON.stringify(i.schema[l].placeholder).replace(/\"/g,"")+'"'),i.schema[l].type.fields){var g="<tr id='cols'>";for(var h in i.schema[l].type.fields)g+="<th id='"+i.schema[l].type.fields[h].id+"' type='"+i.schema[l].type.fields[h].type.dataType+"' description='"+i.schema[l].type.fields[h].id+"'>"+i.schema[l].type.fields[h].label+"</th>";if(g+="</tr>",i.schema[l]["default"]){var m="";if("scriptAction"==i.schema[l]["default"].type)m+="<tr id='data' value=\""+JSON.stringify(i.schema[l]["default"]).replace(/\"/g,"'")+'" ></tr>';else{var y=i.schema[l].type.fields.length,b=0;for(var v in i.schema[l]["default"]){for(var S in m+="<tr id='data'>",i.schema[l]["default"][v])b<y&&(m+="<td>"+i.schema[l]["default"][v][S]+"</td>",b++);m+="</tr>"}}}}if(i.options.externalValidations)for(var x in i.options.externalValidations)for(var w in i.options.externalValidations[x].target)l==i.options.externalValidations[x].target[w]&&(r+=' options="'+JSON.stringify(i.options.externalValidations[x]).replace(/\"/g,"'")+'"');r+=">","dropDown"!=u&&"multiSelect"!=u||!p||(r+=p,p=""),"datagrid"==u&&(r+=g,r+=m),r+=d}r+="</section>"}r+="</form>"}r+="</div>";try{t.writeFileSync(a.join("src/app","app.component.html"),r)}catch(O){console.log("ERROR importForm() writing to the app.component.html file:"+O)}},e.CustFormBuilderModule=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=cust-form-builder.umd.min.js.map